<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVADA - Consulta Veicular</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- Lucide Icons Inline (versão leve) -->
    <script type="text/babel">
        window.LucideIcons = {
            Search: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>`,
            Car: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></svg>`,
            ShieldCheck: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>`,
            Loader2: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>`,
            AlertOctagon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>`,
            X: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,
            Download: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>`,
            Info: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>`,
            Coins: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg>`,
            Globe: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>`,
            ArrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`
        };

        function Icon({ name, size = 24, className = "" }) {
            return <span
                className={className}
                style={{ display: 'inline-block', width: size, height: size }}
                dangerouslySetInnerHTML={{ __html: window.LucideIcons[name] || '' }}
            />;
        }
    </script>

    <!-- App React -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        const API_TOKEN = "c097d785f9c7905b8136396f52652100";
        const VEHICLE_API_BASE = "https://wdapi2.com.br";

        function App() {
            const [placa, setPlaca] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [vehicleData, setVehicleData] = useState(null);
            const [showModal, setShowModal] = useState(false);
            const [saldo, setSaldo] = useState(null);

            useEffect(() => {
                fetch(`${VEHICLE_API_BASE}/saldo/${API_TOKEN}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data && data.qtdConsultas !== undefined) {
                            setSaldo(data.qtdConsultas);
                        }
                    })
                    .catch(() => { });
            }, []);

            const handleConsultar = async (e) => {
                e.preventDefault();
                const cleanPlate = placa.replace(/[^A-Z0-9]/g, '').toUpperCase();

                if (cleanPlate.length < 7) {
                    setError("Placa inválida. Digite os 7 caracteres.");
                    return;
                }

                setLoading(true);
                setError(null);
                setVehicleData(null);

                try {
                    const response = await fetch(`${VEHICLE_API_BASE}/consulta/${cleanPlate}/${API_TOKEN}`);
                    const data = await response.json();

                    if (data.error || (data.codigoSituacao && data.codigoSituacao !== '0')) {
                        throw new Error(data.message || `Erro da API: Código ${data.codigoSituacao}`);
                    }

                    setVehicleData(data);
                    setShowModal(true);

                    // Atualizar saldo
                    fetch(`${VEHICLE_API_BASE}/saldo/${API_TOKEN}`)
                        .then(r => r.json())
                        .then(d => d.qtdConsultas && setSaldo(d.qtdConsultas))
                        .catch(() => { });
                } catch (err) {
                    setError(err.message || "Erro desconhecido.");
                } finally {
                    setLoading(false);
                }
            };

            const voltarCRM = () => {
                window.location.href = '/crm.html';
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 flex flex-col overflow-x-hidden">
                    {/* NAVBAR */}
                    <nav className="bg-white border-b border-slate-200 sticky top-0 z-50 px-6 py-4 flex flex-col md:flex-row justify-between items-center shadow-sm">
                        <div className="flex items-center gap-4 w-full md:w-auto justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-slate-900 text-white p-2 rounded-lg">
                                    <Icon name="ShieldCheck" size={24} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-black tracking-tight text-slate-900 leading-none">AVADA CONSULTA</h1>
                                    <span className="text-[10px] font-bold text-slate-500 tracking-widest uppercase">Sistema Veicular</span>
                                </div>
                            </div>
                        </div>

                        <div className="flex items-center gap-4 mt-4 md:mt-0">
                            <button
                                onClick={voltarCRM}
                                className="flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-xs font-bold uppercase tracking-wide transition-colors"
                            >
                                <Icon name="ArrowLeft" size={16} /> Voltar ao CRM
                            </button>

                            <div className="flex items-center gap-2 px-4 py-1.5 bg-slate-50 border border-slate-200 rounded-full">
                                <Icon name="Coins" size={16} className="text-amber-500" />
                                <span className="text-xs font-bold text-slate-600">{saldo ?? '...'} CRÉDITOS</span>
                            </div>
                        </div>
                    </nav>

                    {/* FORMULÁRIO */}
                    <section className="bg-white py-16 border-b border-slate-100">
                        <div className="max-w-4xl mx-auto px-6 text-center">
                            <div className="inline-flex items-center gap-2 px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-bold mb-6 border border-blue-100">
                                <Icon name="Globe" size={12} /> Consulta Nacional Oficial
                            </div>

                            <h2 className="text-3xl md:text-5xl font-black text-slate-900 mb-4 tracking-tight">
                                Relatório com histórico do Veículo
                            </h2>

                            <p className="text-slate-500 text-lg mb-10 max-w-2xl mx-auto font-medium leading-relaxed">
                                Consulte a procedência integral, restrições e dados técnicos oficiais em tempo real.
                            </p>

                            <div className="bg-white p-2 rounded-2xl shadow-xl border border-slate-200 max-w-lg mx-auto w-full transition-all focus-within:ring-4 focus-within:ring-blue-50">
                                <form onSubmit={handleConsultar} className="flex flex-col md:flex-row gap-2 w-full">
                                    <div className="relative flex-1 w-full">
                                        <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
                                            <Icon name="Search" size={20} />
                                        </div>
                                        <input
                                            type="text"
                                            maxLength={7}
                                            placeholder="DIGITE A PLACA"
                                            value={placa}
                                            onChange={(e) => setPlaca(e.target.value.toUpperCase())}
                                            className="w-full h-14 pl-12 pr-4 bg-slate-50 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white text-xl font-mono font-bold text-slate-900 placeholder:text-slate-400 text-center uppercase tracking-widest outline-none transition-all"
                                        />
                                    </div>
                                    <button
                                        type="submit"
                                        disabled={loading}
                                        className="bg-slate-900 hover:bg-black text-white px-8 h-14 rounded-xl font-bold text-sm transition-all disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2 w-full md:w-auto whitespace-nowrap shadow-lg"
                                    >
                                        {loading ? <Icon name="Loader2" size={20} /> : "EFETUAR CONSULTA"}
                                    </button>
                                </form>
                            </div>

                            {error && (
                                <div className="mt-6 inline-flex items-center gap-2 text-red-600 bg-red-50 px-4 py-2 rounded-lg text-sm font-bold border border-red-100 animate-in text-left w-full max-w-lg">
                                    <Icon name="AlertOctagon" size={16} className="shrink-0" />
                                    {error}
                                </div>
                            )}
                        </div>
                    </section>

                    {/* FOOTER */}
                    <footer className="bg-slate-900 py-10 text-center text-white mt-auto">
                        <p className="font-bold tracking-wide">By Avada Consultoria de Trânsito ®</p>
                    </footer>

                    {/* MODAL */}
                    {showModal && vehicleData && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm animate-in">
                            <div className="bg-white w-full max-w-4xl max-h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border-2 border-slate-200">
                                <div className="bg-white border-b border-slate-100 px-6 py-4 flex justify-between items-center shrink-0">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-blue-50 p-2 rounded-lg text-blue-600">
                                            <Icon name="Car" size={24} />
                                        </div>
                                        <div>
                                            <h3 className="text-xl font-black text-slate-900 leading-none uppercase">
                                                {vehicleData.marcaModelo || "VEÍCULO IDENTIFICADO"}
                                            </h3>
                                            <span className="text-sm font-mono font-bold text-slate-600 bg-slate-100 px-2 py-0.5 rounded border border-slate-200 mt-1 inline-block">
                                                {vehicleData.placa}
                                            </span>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setShowModal(false)}
                                        className="p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition-colors"
                                    >
                                        <Icon name="X" size={24} />
                                    </button>
                                </div>

                                <div className="flex-1 overflow-y-auto bg-slate-50 p-6">
                                    <div className="max-w-3xl mx-auto space-y-3">
                                        <div className="flex items-center gap-2 bg-blue-50 border border-blue-200 p-4 rounded-xl text-blue-800 text-sm font-bold mb-6">
                                            <Icon name="Info" size={18} />
                                            <span>Dados oficiais da base nacional de veículos</span>
                                        </div>

                                        {Object.entries(vehicleData).map(([key, value]) => {
                                            if (typeof value === 'object' || value === null) return null;
                                            return (
                                                <div key={key} className="flex flex-col md:flex-row justify-between md:items-center py-3 border-b border-slate-100 hover:bg-slate-50 px-3 transition-colors">
                                                    <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest w-full md:w-1/3 mb-1 md:mb-0">
                                                        {key}
                                                    </span>
                                                    <span className="text-sm font-bold text-slate-900 font-mono break-all w-full md:w-2/3 text-left md:text-right">
                                                        {String(value)}
                                                    </span>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div className="bg-white border-t border-slate-200 px-8 py-5 flex justify-end shrink-0">
                                    <button
                                        onClick={() => setShowModal(false)}
                                        className="px-6 py-2.5 rounded-lg border border-slate-200 text-slate-600 text-sm font-bold hover:bg-slate-50 transition-colors uppercase tracking-wider"
                                    >
                                        Fechar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Renderizar
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>